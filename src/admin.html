
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>


    
    <div class="login">
        <div class="container2">
            <div class="heading">Log In</div>
            <form class="form" action="">
              <input
                placeholder="E-mail"
                id="email"
                name="email"
                type="email"
                class="input"
                required=""
              />
              <input
                placeholder="Password"
                id="password"
                name="password"
                type="password"
                class="input"
                required=""
              />
              
              <input value="Log In" type="submit" class="login-button" id="sign_in">
            </form>
           
           
          </div>
          
    </div>


    <div class="my_blog11">

     <!-- my blog area admin -->
      <div class="my_blog">
        <header>
            <nav>
                <div class="logo">
                    <a href="#"><img src="https://firebasestorage.googleapis.com/v0/b/dbms-d5864.appspot.com/o/Cultfiesta%2Flogo.webp?alt=media&token=4ccaece3-b5db-4d8b-8691-a5a1b6353b81" alt="Logo"></a>
                </div>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                   
                    <li><a href="../Analysis/index.html">Report</a></li>

                    <li><a href="#" id="logout">Logout</a></li>
                </ul>
            </nav>
        </header>
          <div class="notify"></div>
          <div class="container main">

            
            <div class="dropdown_container">
                <div class="dropdown_trigger"><h3>Events</h3></div>
                <div class="dropdown_content">
                    <div class="main_content" style="overflow: hidden;">
                        <!-- post form -->
                        <div class="row">
                            <div class="col"> 
                                <div class="post_form">
                                    <label>Title</label>
                                    <br>
                                    <input type="text" id="title" placeholder="Enter title">
                                    <br>
                                    <label>Poster</label>
                                    <br>
                                    <input type="file" id="post_image">
                                    <br>
                                    <label>Short Description</label>
                                    <br>
                                    <textarea id="post_content" cols="30" rows="2" placeholder="Short Description"></textarea>
                                    <br>
                                    <label>Long Description</label>
                                    <br>
                                    <textarea id="post2_content" cols="30" rows="3" placeholder="Long Description"></textarea>
                                    <br>
                                    <label>Date</label>
                                    <br>
                                    <input type="date" id="date">
                                    <br>
                                    <script>
                                      document.addEventListener("DOMContentLoaded", function () {
                                        let today = new Date().toISOString().split("T")[0];
                                        document.getElementById("date").setAttribute("min", today);
                                      });
                                    </script>
                                    <label>Venue</label>
                                    <br>
                                    <input type="text" id="venue" placeholder="Enter Venue">
                                    <br>
                                    <label>Pre-requisites</label>
                                    <br>
                                    <textarea id="prerequists" cols="30" rows="2" placeholder="Pre-requisites"></textarea>
                                    <br>
                                    <label>Fee</label>
                                    <br>
                                    <input type="text" id="fee" placeholder="Enter Fee">
                                    <br>
                                    <label>Time</label>
                                    <br>
                                    <input type="text" id="time" placeholder="Enter Time">
                                    <br>
                                    <label>Club Name</label>
                                    <br>
                                    <input type="text" id="cName" placeholder="Club Name">
                                    <br>
                                    <label for="department">Department:</label>
                                    <br>
                                    <select id="department">
                                      <option value="AI&ML">AI&ML</option>
                                      <option value="ECE">ECE</option>
                                      <option value="CSE">CSE</option>
                                      <option value="Mechanical">Mechanical</option>
                                      <option value="Civil">Civil</option>
                                      <option value="Electrical">Electrical</option>
                                    </select>
                                    
                                    <br>
                                    <label>Outcome</label>
                                    <br>
                                    <input type="text" id="outcome" placeholder="Outcome">
                                    <br>
                                    <label>Phone number</label>
                                    <br>
                                    <input type="text" id="number1" placeholder="Number 1">
                                    <br>
                                    <input type="text" id="number2" placeholder="Number 2">
                                    <br>
                                    <label>Registration Link</label>
                                    <br>
                                    <input type="text" id="link1" placeholder="Registration link">
                                    <br>
                                    <label>Club Link</label>
                                    <br>
                                    <input type="text" id="link2" placeholder="Club link">
                                    <br>
                                    <select id="category">
                                        <option value="Technical">Technical</option>
                                        <option value="Non-Technical">Non-Technical</option>
                                        <option value="Sports">Sports</option>
                                        <option value="Workshops">Workshops</option>
                                      </select>
                                    <button id="post_btn" class="post_btn">Post Now</button>
                                    <br>
                                    <button id="update_btn" class="update_btn">Update Post</button>
                                    <br>
                                </div>
                            </div>
                            <div class="col">      
                                <div class="my_content">
                                    <h2>My Posts</h2>
                                    <table>
                                        <!-- Table content -->
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- Table -->
                    </div>
                </div>
            </div>
        </div>
            <!-- Announcements -->
            <div class="container main" >

            
                <div class="dropdown_container">
                    <div class="dropdown_trigger"><h3>Announcements</h3></div>
                    <div class="dropdown_content">
                        <div class="main_content" style="overflow: hidden;">
                            <!-- post form -->
                            <div class="row">
                                <div class="col-md-7"> 
                                    <div class="post_form">
                                        <label>Title</label>
                                        <br>
                                        <input type="text" id="title2" placeholder="Enter Announcement">
                                        <br>
                                       
                                        <select id="colorPicker">
                                            <option value="white">White</option>

                                            <option value="black">Black</option>
                                            <option value="red">Red</option>
                                            <option value="green">Green</option>
                                            <option value="blue">Blue</option>
                                            <option value="blinking">Blinking (Red/White)</option>
                                        </select>
                                        <style>.blinking {
                                            animation: blinkingAnimation 1s infinite alternate;
                                          }
                                          
                                          @keyframes blinkingAnimation {
                                            from {
                                              color: red;
                                            }
                                            to {
                                              color: white;
                                            }
                                          }
                                          .blinking {
  animation: blinkingAnimation 1s infinite alternate;
}

@keyframes blinkingAnimation {
  from {
    color: red;
  }
  to {
    color: white;
  }
}

                                          </style>
                                        <button id="post_btn1" class="post_btn1">Post Now</button>
                                        <br>
                                        <button id="update_btn1" class="update_btn1">Update Post</button>
                                        <br>
                                    </div>
                                </div>
                                <div class="col">      
                                    <div class="my_content2">
                                     
                                        <table id="announcement_table">
                                            <!-- Table content -->
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- Table -->
                        </div>
                    </div>
                </div>
            </div> 
            <!-- ====================================
            
            -->
            <div class="container main">

            
                <div class="dropdown_container">
                    <div class="dropdown_trigger"><h3 >Timeline</h3></div>
                    <div class="dropdown_content">
                        <div class="main_content" style="overflow: hidden;">
                            <!-- post form -->

    <div class="row">
                                <div class="col"> 
                                    <div class="post_form">
                                        <label>Title</label>
                                        <br>
                                        <input type="text" id="title3" placeholder="Enter title">
                                        <br>
                                        <label>Poster</label>
                                        <br>
                                        <input type="file" id="post_image2">
                                        
                                        <select id="category2">
                                            <option value="cover">Cover</option>
                                            <option value="fill">Fill</option>
                                            <option value="contain">Contain</option>
                                          </select>
                                          <input type="file" id="post_image3">
                                        
                                          <select id="category2">
                                              <option value="cover">Cover</option>
                                              <option value="fill">Fill</option>
                                              <option value="contain">Contain</option>
                                            </select>
                                            
                                            <input type="file" id="post_image4">
                                        
                                            <select id="category2">
                                                <option value="cover">Cover</option>
                                                <option value="fill">Fill</option>
                                                <option value="contain">Contain</option>
                                                <option value="cover">Cover2-350px</option>
                                              </select>
                                        <button id="post_btn3" class="post_btn3">Post Now</button>
                                        <br>
                                        <button id="update_btn3" class="update_btn3">Update Post</button>
                                        <br>
                                    </div>
                                </div>
                                <div class="col">      
                                    <div class="my_content">
                                        <h2>My Posts</h2>
                                        <table id="timeline">
                                            <!-- Table content -->
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- Table -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- ====================================
            
            -->
            <div class="container main">
              <div class="dropdown_container">
                  <div class="dropdown_trigger"><h3>Sponsors</h3></div>
                  <div class="dropdown_content">
                      <div class="main_content" style="overflow: hidden;">
                          <div class="row">
                              <div class="col"> 
                                  <div class="post_form">
                                      <label>Title</label>
                                      <br>
                                      <input type="text" id="title4" placeholder="Enter title">
                                      <br>
                                      <label>Poster</label>
                                      <br>
                                      <input type="file" id="post_image5">
                                      <select id="category3">
                                          <option value="cover">Cover</option>
                                          <option value="fill">Fill</option>
                                          <option value="contain">Contain</option>
                                          

                                      </select>
                                      <button id="post_btn4" class="post_btn3">Post Now</button>
                                      <br>
                                      <button id="update_btn4" class="update_btn3">Update Post</button>
                                      <br>
                                  </div>
                              </div>
                              <div class="col">      
                                  <div class="my_content">
                                      <h2>My Posts</h2>
                                      <table id="Sponsors">
                                          <!-- Table content -->
                                      </table>
                                  </div>
                              </div>
                          </div>
                          <div id="notify"></div> <!-- Notification Element -->
                      </div>
                  </div>
              </div>
          </div>

          <!-- ========================================================= -->



          <div class="container main">
            <div class="dropdown_container">
                <div class="dropdown_trigger"><h3>Clubs</h3></div>
                <div class="dropdown_content">
                    <div class="main_content" style="overflow: hidden;">
                        <div class="row">
                            <div class="col"> 
                                <div class="post_form">
                                    <label>Club Title</label>
                                    <input type="text" id="Ctitle" placeholder="Enter club title">
                                    
                                    <label>Main Image (Right)</label>
                                    <input type="file" id="imageR">
                                    
                                    <label>Main Image (Left)</label>
                                    <input type="file" id="imageL">
                                    
                                    <label>Short Description</label>
                                    <textarea id="description1" cols="30" rows="2" placeholder="Short description"></textarea>
                                    
                                    <label>Detailed Description</label>
                                    <textarea id="description2" cols="30" rows="3" placeholder="Detailed description"></textarea>
        
                                    <h4>Activities</h4>
                                    <div class="activity-section">
                                        <!-- Activity 1 -->
                                        <label>Activity 1 Title</label>
                                        <input type="text" id="act_title" placeholder="Activity title">
                                        <label>Activity 1 Description</label>
                                        <textarea id="act_desc" placeholder="Activity description"></textarea>
                                        <input type="file" id="act1">
        
                                        <!-- Activity 2 -->
                                        <label>Activity 2 Title</label>
                                        <input type="text" id="act_title2" placeholder="Activity title">
                                        <label>Activity 2 Description</label>
                                        <textarea id="act_desc2" placeholder="Activity description"></textarea>
                                        <input type="file" id="act2">
        
                                        <!-- Activity 3 -->
                                        <label>Activity 3 Title</label>
                                        <input type="text" id="act_title3" placeholder="Activity title">
                                        <label>Activity 3 Description</label>
                                        <textarea id="act_desc3" placeholder="Activity description"></textarea>
                                        <input type="file" id="act3">
                                    </div>
        
                                    <h4>Gallery Images (8 images)</h4>
                                    <div class="gallery-uploads">
                                        <input type="file" id="gal1">
                                        <input type="file" id="gal2">
                                        <input type="file" id="gal3">
                                        <input type="file" id="gal4">
                                        <input type="file" id="gal5">
                                        <input type="file" id="gal6">
                                        <input type="file" id="gal7">
                                        <input type="file" id="gal8">
                                    </div>
        
                                    <h4>Contact Details</h4>
                                    <label>Reach Out Text</label>
                                    <input type="text" id="reach_out" placeholder="Reach out message">
                                    
                                    <label>Phone Numbers</label>
                                    <input type="text" id="Cnumber1" placeholder="Primary number">
                                    <input type="text" id="Cnumber2" placeholder="Secondary number">
                                    
                                    <label>Instagram Details</label>
                                    <input type="url" id="instaURL" placeholder="Instagram URL">
                                    <input type="text" id="insta_id" placeholder="Instagram Handle">
                                    
                                    <label>Email</label>
                                    <input type="email" id="Email" placeholder="Club email">
        
                                    <label>Club Poster</label>
                                    <input type="file" id="poster">
        
                                    <button id="club_post_btn" class="post_btn">Create Club</button>
                                    <button id="club_update_btn" class="update_btn">Update Club</button>
                                </div>
                            </div>
                            <div class="col">      
                                <div class="my_content">
                                    <h2>My Clubs</h2>
                                    <table id="clubs_table">
                                        <!-- Clubs will be populated here -->
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>





            <script>
                // JavaScript for toggling dropdown
                document.addEventListener("DOMContentLoaded", function() {
                    document.querySelectorAll(".dropdown_trigger").forEach(function(trigger) {
                        trigger.addEventListener("click", function() {
                            var content = this.nextElementSibling;
                            content.style.display = content.style.display === "block" ? "none" : "block";
                        });
                    });
                });
            </script>
          









          

































  
      </div>
    </div>
<section class="footer">
    <h4>About Us</h4>
    <p>You Plan, We gather! <br>Our club dea
      ls with Organising, Conducting
        and Organising events </p>
        <div class="icons">
           <a href="https://www.instagram.com/cristiano/?hl=en"> <i class="fa-brands fa-instagram fa-beat-fade"></i></a>
           <a href=""> <i class="fa-brands fa-discord"></i></a>
                <i class="fa-solid fa-phone"></i>
                <i class="fa-solid fa-location-dot"></i>
  
        </div>
  <p>Made With  <i class="fa-regular fa-heart"></i> by CultFiesta</p>
  
  </section>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</script>

      <script type="module" >// Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
        import { getDatabase, set, ref, get, remove, update } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyClkiHJX3mR4SdQQ2jzuG-n7ZNzuYD2REE",
          authDomain: "dbms-d5864.firebaseapp.com",
          projectId: "dbms-d5864",
          storageBucket: "dbms-d5864.appspot.com",
          messagingSenderId: "478043315963",
          appId: "1:478043315963:web:02a9cd2c70c4755bce5a5e",
          measurementId: "G-W7EKCZXJ0J"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const storage = getStorage(app);
        
        const my_blog = document.querySelector('.my_blog');
        const login_page = document.querySelector('.login');
        const notify = document.querySelector('.notify');
        const add_post_btn = document.querySelector('#post_btn');
        const update_btn = document.querySelector('.update_btn');
        
        // Admin UID and Regular User UIDs with names
        const adminUID = {'QkNkwVJ8eva41VrDFcyvJxlQwLl1': 'ADMIN'} ;  // Admin UID
        const users = {
          'wthrtDIUGUVvzyw4PC1M6rZXOY63': 'CSE',
          'quZ07wePADe95oEStgNQAZQXsz43': 'DS',
          '7EOyN1WeuGVIBIDBFPRrn0ShQLk1': 'AI&ML',
          'g2vEL3fTo4dokz2T69Vc3YjHoHD3': 'ECE',
          '6JnzSPiYLSbpVaxFmQ3KT0IVvJ93': 'Mechanical',
          'UWLCuim8pQYzRKhO978TlZ3B1y93': 'CY',
          '1TfsefP3v5SxSLwh3TZMn2j6JVA2': 'Civil',
          'Ko1YNqBbuQhKYyNtVGuBUeU14Je2': 'ISE',
          'JgEwgOBp9ASpkEbCgGSFfomTPQ92': 'EEE'




          



        }; // Regular User UIDs and names
        
        onAuthStateChanged(auth, (user) => {
          if (user) {
            my_blog.classList.add('show');
            login_page.classList.add('hide');
          } else {
            my_blog.classList.remove('show');
            login_page.classList.remove('hide');
          }
        });
        
        function SignInUser(event) {
          event.preventDefault();  // Prevent default form submission
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          signInWithEmailAndPassword(auth, email, password)
            .then((userCredentials) => {
              console.log(userCredentials.user.uid);
            })
            .catch((error) => {
              console.error("Sign in error: ", error);
            });
        }
        
        const sign_btn = document.querySelector('#sign_in');
        sign_btn.addEventListener('click', SignInUser);
        
        const sign_out_btn = document.querySelector('#logout');
        sign_out_btn.addEventListener('click', () => {
          signOut(auth).then(() => {
            notify.innerHTML = "Signed out successfully";
            setTimeout(() => {
              location.reload();
            }, 2000);
          }).catch((error) => {
            console.log("Sign out error: ", error);
          });
        });
        
        // Modify Add_Post function to include user UID and selected category
        function LogPostDetails(id,department, cName, date, category) {
    const logRef = ref(db, `logs/${id}`);
    set(logRef, {
        
        department: department,
        club: cName, // Log cName as club
        date: date,
        category: category

    }).then(() => {
        console.log("Post details logged successfully.");
    }).catch((error) => {
        console.error("Error logging post details: ", error);
    });
}

// Function to Add a New Post
function Add_Post() {
    const title = document.querySelector('#title').value;
    const post_content = document.querySelector('#post_content').value;
    const post2_content = document.querySelector('#post2_content').value;
    const post_image = document.querySelector('#post_image').files[0];
    const date = document.querySelector('#date').value;
    const venue = document.querySelector('#venue').value;
    const prerequists = document.querySelector('#prerequists').value;
    const fee = document.querySelector('#fee').value;
    const time = document.querySelector('#time').value;
    const cName = document.querySelector('#cName').value;
    const outcome = document.querySelector('#outcome').value;
    const number1 = document.querySelector('#number1').value;
    const number2 = document.querySelector('#number2').value;
    const link1 = document.querySelector('#link1').value;
    const link2 = document.querySelector('#link2').value;
    const category = document.querySelector('#category').value;
    const department = document.querySelector('#department').value; // Get selected category from dropdown

    const user = auth.currentUser; // Get the logged-in user

    if (!user) {
        alert("You must be logged in to add a post.");
        return;
    }

    if (!post_image) {
        alert("Please select an image");
        return;
    }

    const id = Date.now();
    const imageRef = storageRef(storage, `images/${id}-${post_image.name}`);

    uploadBytes(imageRef, post_image).then((snapshot) => {
        return getDownloadURL(snapshot.ref);
    }).then((downloadURL) => {
        return set(ref(db, 'post/' + id), {
            title: title,
            post_content: post_content,
            post2_content: post2_content,
            imageURL: downloadURL,
            date: date,
            venue: venue,
            prerequists: prerequists,
            fee: fee,
            time: time,
            cName: cName,
            outcome: outcome,
            number1: number1,
            number2: number2,
            link1: link1,
            link2: link2,
            category: category,
            department: department,
            uid: user.uid // Store the UID of the user creating the post
        });
    }).then(() => {
        // Log post details separately
        LogPostDetails(id, department, cName, date, category);

        notify.innerHTML = "Data Added";
        clearFields();
        GetPostData();
    }).catch((error) => {
        console.error("Error uploading file: ", error);
        notify.innerHTML = "Error adding data";
    });
}

add_post_btn.addEventListener('click', Add_Post);

// Function to Clear Input Fields
function clearFields() {
    document.querySelector('#title').value = "";
    document.querySelector('#post_content').value = "";
    document.querySelector('#post2_content').value = "";
    document.querySelector('#post_image').value = "";
    document.querySelector('#date').value = "";
    document.querySelector('#venue').value = "";
    document.querySelector('#prerequists').value = "";
    document.querySelector('#fee').value = "";
    document.querySelector('#time').value = "";
    document.querySelector('#cName').value = "";
    document.querySelector('#outcome').value = "";
    document.querySelector('#number1').value = "";
    document.querySelector('#number2').value = "";
    document.querySelector('#link1').value = "";
    document.querySelector('#link2').value = "";
    document.querySelector('#category').value = "";
    document.querySelector('#department').value = "";
    // Removed: document.querySelector('#club').value = ""; // No longer needed
}

document.addEventListener("DOMContentLoaded", function () {
    console.log("Script is running!");

    // ✅ Event Delegation: Listen for clicks on dynamically added buttons
    document.addEventListener("click", function (event) {
        if (event.target.classList.contains("generate-btn")) {
            console.log("Generate button clicked!");
            generatePDF(event.target);
        }
    });

    // ✅ Now fetch the posts AFTER the DOM is ready
    GetPostData();
});

function GetPostData() {
    const user_ref = ref(db, 'post/');
    get(user_ref).then((snapshot) => {
        const data = snapshot.val();
        let html = "";
        const table = document.querySelector('table');

        for (const key in data) {
            const { title, post_content, post2_content, imageURL, uid } = data[key];
            const username = users[uid] || "ADMIN"; // Get username or default to "ADMIN"

            html += `
<tr>
    <td><span class="postNumber"></span></td>
    <td class="separator">
        <div><b>${title}</b> by <i>${username}</i></div>
        <img src="${imageURL}" alt="Post Image" style="width:100px;height:100px;">
    </td>
    <td class="separator">
        <button class="delete" onclick="delete_data('${key}', '${uid}')">Delete</button>
    </td>
    <td class="separator">
        <button class="update" onclick="update_data('${key}', '${uid}')">Update</button>
    </td>
    <td class="separator">
       <button class="generate-btn" 
           data-title="${title}"
           data-user="${username}"
           data-date="${data[key].date || 'Date'}"
           data-time="${data[key].time || 'Time'}"
           data-venue="${data[key].venue || 'Venue'}"
           data-club="${data[key].cName || 'Club Name'}"
           data-department="${data[key].department || 'Department'}"
           data-coord1="${data[key].number1 || 'Coordinator 1'}"
           data-coord2="${data[key].number2 || 'Coordinator 2'}"
       >Generate</button>
    </td>
</tr>`;
        }

        table.innerHTML = html;
        console.log("Table updated with new posts!");
    }).catch((error) => {
        console.error("Error fetching posts: ", error);
    });
}

function generatePDF(button) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Load local image dynamically
    let img = new Image();
    img.src = "../logo.jpeg"; // Image in the same folder

    img.onload = function () {
        doc.addImage(img, "PNG", 10, 10, 30, 30); // Adjust (x, y, width, height)

        // PDF Header
        doc.setFont("helvetica", "bold");
        doc.setFontSize(18);
        doc.text("R N SHETTY TRUST®", 105, 20, { align: "center" });
        doc.text("RNS INSTITUTE OF TECHNOLOGY", 105, 30, { align: "center" });

        // Normal text
        doc.setFontSize(12);
        doc.setFont("helvetica", "normal");
        doc.text("Autonomous Institution Affiliated to VTU, Recognized by GOK, Approved by AICTE", 105, 40, { align: "center" });
        doc.text("NAAC ‘A+ Grade’ Accredited, NBA Accredited (UG - CSE, ECE, ISE, EIE and EEE)", 105, 50, { align: "center" });
        doc.text("Channasandra, Dr. Vishnuvardhan Road, Bengaluru - 560 098", 105, 60, { align: "center" });
        doc.text("Ph: (080)28611880, 28611881 | URL: www.rnsit.ac.in", 105, 70, { align: "center" });

        // Divider
        doc.line(20, 75, 190, 75);

        // Event Name
        doc.setFontSize(16);
        doc.setFont("helvetica", "bold");
        doc.text(title.toUpperCase(), 105, 90, { align: "center" });

        // Event Details
        doc.setFontSize(12);
        doc.setFont("helvetica", "normal");
        doc.text(`The ${title} was conducted on ${date}, ${time} at ${venue} by the`, 20, 110);
        doc.text(`${cName} of the department ${department}.`, 20, 120);

        // Coordinators
        doc.setFont("helvetica", "bold");
        doc.text("Coordinators:", 20, 140);
        doc.setFont("helvetica", "normal");
        doc.text(`- ${coord1}`, 20, 150);
        doc.text(`- ${coord2}`, 20, 160);

        // Save the PDF after image loads
        doc.save(`${title}.pdf`);
    };
}















// Function to Delete a Post
window.delete_data = function (key, postUID) {
    const user = auth.currentUser;

    if (!user) {
        alert("You must be logged in to delete a post.");
        return;
    }

    if (adminUID[user.uid] || user.uid === postUID) { // Admin or owner can delete
        const post_ref = ref(db, `post/${key}`);

        get(post_ref).then((snapshot) => {
            if (!snapshot.exists()) {
                alert("Post does not exist.");
                return;
            }

            const data = snapshot.val();
            const imageURL = data.imageURL;

            // Remove the post data
            remove(post_ref).then(() => {
                // Extract the image path from the imageURL
                const storagePath = decodeURIComponent(imageURL.split('/o/')[1].split('?')[0]);
                const imageRef = storageRef(storage, storagePath);
                return deleteObject(imageRef);
            }).then(() => {
                notify.innerHTML = "Post and associated image deleted successfully";
                GetPostData();
            }).catch((error) => {
                console.error("Error deleting data: ", error);
                notify.innerHTML = "Error deleting post";
            });
        }).catch((error) => {
            console.error("Error fetching post data: ", error);
            notify.innerHTML = "Error fetching post data";
        });
    } else {
        alert("You can only delete posts created by you!");
    }
}

// Function to Update a Post
window.update_data = function (key, postUID) {
    const user = auth.currentUser;

    if (!user) {
        alert("You must be logged in to update a post.");
        return;
    }

    if (adminUID[user.uid] || user.uid === postUID) {  // Admin or owner can update
        update_btn.classList.remove('hide');
        add_post_btn.classList.add('hide');
        const post_ref = ref(db, `post/${key}`);
        get(post_ref).then((snapshot) => {
            if (!snapshot.exists()) {
                alert("Post does not exist.");
                return;
            }

            const data = snapshot.val();
            document.querySelector('#title').value = data.title;
            document.querySelector('#post_content').value = data.post_content;
            document.querySelector('#post2_content').value = data.post2_content;
            document.querySelector('#date').value = data.date;
            document.querySelector('#venue').value = data.venue;
            document.querySelector('#prerequists').value = data.prerequists;
            document.querySelector('#fee').value = data.fee;
            document.querySelector('#time').value = data.time;
            document.querySelector('#cName').value = data.cName;
            document.querySelector('#outcome').value = data.outcome;
            document.querySelector('#number1').value = data.number1;
            document.querySelector('#number2').value = data.number2;
            document.querySelector('#link1').value = data.link1;
            document.querySelector('#link2').value = data.link2;
            document.querySelector('#category').value = data.category; // Populate category field
            document.querySelector('#department').value = data.department;

            // Store the key for updating
            update_btn.setAttribute('data-key', key);
        }).catch((error) => {
            console.error("Error fetching post data: ", error);
            notify.innerHTML = "Error fetching post data";
        });
    } else {
        alert("You can only update posts created by you!");
    }
}

// Event Listener for Update Button
update_btn.addEventListener('click', () => {
    const key = update_btn.getAttribute('data-key');
    const title = document.querySelector('#title').value;
    const post_content = document.querySelector('#post_content').value;
    const post2_content = document.querySelector('#post2_content').value;
    const date = document.querySelector('#date').value;
    const venue = document.querySelector('#venue').value;
    const prerequists = document.querySelector('#prerequists').value;
    const fee = document.querySelector('#fee').value;
    const time = document.querySelector('#time').value;
    const cName = document.querySelector('#cName').value;
    const outcome = document.querySelector('#outcome').value;
    const number1 = document.querySelector('#number1').value;
    const number2 = document.querySelector('#number2').value;
    const link1 = document.querySelector('#link1').value;
    const link2 = document.querySelector('#link2').value;
    const category = document.querySelector('#category').value; // Get selected category from dropdown
    const department = document.querySelector('#department').value;
    // Removed: const club = document.querySelector('#club').value; // No longer needed

    const user = auth.currentUser; // Get the logged-in user

    if (!user) {
        alert("You must be logged in to update a post.");
        return;
    }

    const post_ref = ref(db, `post/${key}`);
    update(post_ref, {
        title: title,
        post_content: post_content,
        post2_content: post2_content,
        date: date,
        venue: venue,
        prerequists: prerequists,
        fee: fee,
        time: time,
        cName: cName,
        outcome: outcome,
        number1: number1,
        number2: number2,
        link1: link1,
        link2: link2,
        category: category, // Include selected category in the post data
        department: department,
        uid: user.uid // Update the UID of the user creating the post (if changed)
    }).then(() => {
        // After updating the post, also update the log if necessary
        // Optionally, you can update the logs here if any of the logged fields have changed

        notify.innerHTML = "Data Updated";
        clearFields();
        GetPostData();
        update_btn.classList.add('hide');
        add_post_btn.classList.remove('hide');
    }).catch((error) => {
        console.error("Error updating data: ", error);
        notify.innerHTML = "Error updating data";
    });
});

// -------------------------------------------
const add_post_Btn1 = document.querySelector('#post_btn1');
const update_btn1 = document.querySelector('#update_btn1');
let updateKey = null; // Initialize updateKey

// ============================ Announcement Features ============================ //

// Add Announcement Function
function Add_Announcement() {
  const title = document.querySelector('#title2').value;
  const color = document.querySelector('#colorPicker').value; // Get the selected color
  const user = auth.currentUser; // Get the logged-in user

  if (!title) {
    alert("Please enter a title for the announcement.");
    return;
  }

  const id = Date.now(); // Use Date.now() for unique identifier

  set(ref(db, 'announcement/' + id), {
    title: title,
    color: color, // Save the color in Firebase
    uid: user.uid // Store the UID of the user creating the announcement
  }).then(() => {
    notify.innerHTML = "Announcement Added Successfully";
    document.querySelector('#title2').value = "";
    document.querySelector('#colorPicker').value = "#ffffff"; // Reset color picker to default
    GetAnnounData();
  }).catch(error => {
    console.error("Error adding announcement: ", error);
    notify.innerHTML = "Error adding announcement";
  });
}

add_post_Btn1.addEventListener('click', Add_Announcement);

// Get Announcement Data Function
function GetAnnounData() {
  const announ_ref = ref(db, 'announcement/');
  get(announ_ref).then((snapshot) => {
    const data = snapshot.val();

    let html = "";
    const table = document.querySelector('#announcement_table');
    for (const key in data) {
      const { title, color, uid } = data[key];
      let textColorClass = '';
      switch (color) {
        case 'white':
          textColorClass = 'white';
          break;
        case 'green':
          textColorClass = 'green';
          break;
        case 'red':
          textColorClass = 'red';
          break;
        case 'blinking':
          textColorClass = 'blinking';
          break;
        default:
          textColorClass = ''; // or default color class
          break;
      }

      const username = (uid === adminUID) ? "ADMIN" : (users[uid] || "ADMIN");

      html += `
        <tr>
          <td><span class="postNumber"></span></td>
          <td class="${textColorClass}">${title} <br>  <small style="color: white;">by: ${username}</small></td>
          <td><button class="delete" onclick="delete_data1('${key}', '${uid}')">Delete</button></td>
          <td><button class="update" onclick="updateAnnouncement('${key}', '${uid}')">Update</button></td>
        </tr>
      `;
    }

    table.innerHTML = html;
  }).catch(error => {
    console.error("Error fetching announcements: ", error);
    notify.innerHTML = "Error fetching announcements";
  });
}

// Delete Announcement Function
window.delete_data1 = function (key, announUID) {
  const user = auth.currentUser;

  if (user.uid === adminUID || user.uid === announUID) { // Admin or owner can delete
    const announ_ref = ref(db, `announcement/${key}`);

    remove(announ_ref).then(() => {
      notify.innerHTML = "Announcement Deleted Successfully";
      GetAnnounData();
    }).catch(error => {
      console.error("Error deleting announcement: ", error);
      notify.innerHTML = "Error deleting announcement";
    });
  } else {
    alert("You can only delete announcements created by you!");
  }
};

// Update Announcement Function
window.updateAnnouncement = function (key, announUID) {
  const user = auth.currentUser;

  if (adminUID[user.uid] || user.uid === postUID) {  // Admin or owner can update
    update_btn1.classList.remove('hide');
    add_post_Btn1.classList.add('hide');
    const announ_ref = ref(db, `announcement/${key}`);
    get(announ_ref).then((snapshot) => {
      const data = snapshot.val();
      document.querySelector('#title2').value = data.title;
      const colorPicker = document.querySelector('#colorPicker');
      colorPicker.value = data.color; // Set color picker value
      updateKey = key;

      // Log color value just before updating database
      console.log("Color before update:", data.color);
    }).catch(error => {
      console.error("Error fetching announcement for update: ", error);
      notify.innerHTML = "Error fetching announcement data";
    });
  } else {
    alert("You can only update announcements created by you!");
  }
}

update_btn1.addEventListener('click', function () {
  const title = document.querySelector('#title2').value;
  const color = document.querySelector('#colorPicker').value; // Get selected color
  const user = auth.currentUser; // Get the logged-in user

  if (updateKey) {
    console.log("Color before update:", color); // Log color value before updating
    update(ref(db, `announcement/${updateKey}`), {
      title: title,
      color: color, // Update color value
      uid: user.uid // Update UID if necessary (typically, UID shouldn't change)
    }).then(() => {
      notify.innerHTML = "Announcement Updated Successfully";
      document.querySelector('#title2').value = "";
      document.querySelector('#colorPicker').value = "#ffffff"; // Reset color picker to default
      updateKey = null;
      update_btn1.classList.add('hide');
      add_post_Btn1.classList.remove('hide');
      GetAnnounData();
    }).catch(error => {
      console.error("Error updating announcement: ", error);
      notify.innerHTML = "Error updating announcement";
    });
  }
});

// Initial Data Load

GetAnnounData();

//  --------------------------------



// AddTime function to upload post data
function AddTime() {
  const title = document.querySelector('#title3').value;
  const post_image2 = document.querySelector('#post_image2').files[0];
  const post_image3 = document.querySelector('#post_image3').files[0];
  const post_image4 = document.querySelector('#post_image4').files[0];
  const category2 = document.querySelector('#category2').value;

  const user = auth.currentUser;
  if (!user) {
    alert("You must be logged in to add a post.");
    return;
  }

  if (!post_image2) {
    alert("Please select the first image");
    return;
  }

  const id = Date.now();

  const uploadImage = (file, id, idx) => {
    const imageRef = storageRef(storage, `timeline/${id}-${idx}-${file.name}`);
    return uploadBytes(imageRef, file).then(snapshot => getDownloadURL(snapshot.ref));
  };

  Promise.all([
    uploadImage(post_image2, id, 1),
    post_image3 ? uploadImage(post_image3, id, 2) : Promise.resolve(null),
    post_image4 ? uploadImage(post_image4, id, 3) : Promise.resolve(null)
  ]).then(urls => {
    const imageData = {
      imageURL1: urls[0],
      imageURL2: urls[1],
      imageURL3: urls[2]
    };

    return set(ref(db, 'timeline/' + id), {
      title: title,
      ...imageData,
      category: category2,
      userId: user.uid,  // Store user ID
      userName: user.displayName || "ADMIN"  // Optionally store the user’s name
    });
  }).then(() => {
    notify.innerHTML = "Data Added";
    clearFieldsTimeline();
    GetTimeData();
  }).catch((error) => {
    console.error("Error uploading file: ", error);
    notify.innerHTML = "Error adding data";
  });
}

// Bind AddTime function to the post button
document.querySelector('#post_btn3').addEventListener('click', AddTime);

// Clear form fields after data is added
function clearFieldsTimeline() {
  document.querySelector('#title3').value = "";
  document.querySelector('#post_image2').value = "";
  document.querySelector('#post_image3').value = "";
  document.querySelector('#post_image4').value = "";
  document.querySelector('#category2').value = "";
}

// Get timeline data and display in the table
function GetTimeData() {
  const user_ref = ref(db, 'timeline/');
  get(user_ref).then((snapshot) => {
    const data = snapshot.val();
    let html = "";
    const table = document.querySelector('#timeline');

    for (const key in data) {
      const { title, imageURL1, imageURL2, imageURL3, category, userName } = data[key];

      html += `
        <tr>
          <td><span class="postNumber"></span></td>
          <td class="separator">
            <div><b>${title}</b></div>
            <div>Added by: ${userName || "ADMIN"}</div>
            <img src="${imageURL1}" alt="Post Image 1" class="${category}" style="width:100px;height:100px;">
           
          </td>
          <td class="separator"><button class="delete" onclick="deleteTimeData('${key}')">Delete</button></td>
          <td class="separator"><button class="update" onclick="updateTimeData('${key}')">Update</button></td>
        </tr>
      `;
    }
    table.innerHTML = html;
  });
}

// Delete timeline data
window.deleteTimeData = function (key) {
  const user = auth.currentUser;
  if (!user) {
    alert("You must be logged in to delete a post.");
    return;
  }

  const user_ref = ref(db, `timeline/${key}`);
  get(user_ref).then((snapshot) => {
    const data = snapshot.val();
    if (!data) {
      notify.innerHTML = "Post not found";
      return;
    }

    // Check if the current user is the owner of the post
    if (data.userId !== user.uid) {
      alert("You can only delete your own posts.");
      return;
    }

    const imageRefs = [data.imageURL1, data.imageURL2, data.imageURL3].filter(Boolean).map(url => {
      const fileName = url.split('%2F').pop().split('?')[0];
      return storageRef(storage, `timeline/${fileName}`);
    });

    remove(user_ref).then(() => {
      return Promise.all(imageRefs.map(ref => deleteObject(ref)));
    }).then(() => {
      notify.innerHTML = "Post and associated images deleted successfully";
      GetTimeData();
    }).catch((error) => {
      console.error("Error deleting data: ", error);
      notify.innerHTML = "Error deleting post";
    });
  });
}

// Update timeline data
window.updateTimeData = function (key) {
  const user = auth.currentUser;
  if (!user) {
    alert("You must be logged in to update a post.");
    return;
  }

  const user_ref = ref(db, `timeline/${key}`);
  get(user_ref).then((item) => {
    const data = item.val();
    if (!data) {
      notify.innerHTML = "Post not found";
      return;
    }

    // Check if the current user is the owner of the post
    if (data.userId !== user.uid) {
      alert("You can only update your own posts.");
      return;
    }

    document.querySelector('#title3').value = data.title;
    document.querySelector('#category2').value = data.category;

    // Display update button and hide add button
    document.querySelector('#update_btn3').style.display = 'block';
    document.querySelector('#post_btn3').style.display = 'none';

    // Bind update functionality
    document.querySelector('#update_btn3').onclick = function() {
      updatePostData(key, data.imageURL1, data.imageURL2, data.imageURL3);
    };
  });
}

// Update post data logic
function updatePostData(key, oldImageURL1, oldImageURL2, oldImageURL3) {
  const title = document.querySelector('#title3').value;
  const post_image2 = document.querySelector('#post_image2').files[0];
  const post_image3 = document.querySelector('#post_image3').files[0];
  const post_image4 = document.querySelector('#post_image4').files[0];
  const category2 = document.querySelector('#category2').value;

  const deleteOldImage = (url) => {
    if (!url) return Promise.resolve();
    const fileName = url.split('%2F').pop().split('?')[0];
    const oldImageRef = storageRef(storage, `timeline/${fileName}`);
    return deleteObject(oldImageRef);
  };

  const uploadImage = (file, id, idx) => {
    const imageRef = storageRef(storage, `timeline/${id}-${idx}-${file.name}`);
    return uploadBytes(imageRef, file).then(snapshot => getDownloadURL(snapshot.ref));
  };

  const promises = [
    post_image2 ? deleteOldImage(oldImageURL1).then(() => uploadImage(post_image2, key, 1)) : Promise.resolve(oldImageURL1),
    post_image3 ? deleteOldImage(oldImageURL2).then(() => uploadImage(post_image3, key, 2)) : Promise.resolve(oldImageURL2),
    post_image4 ? deleteOldImage(oldImageURL3).then(() => uploadImage(post_image4, key, 3)) : Promise.resolve(oldImageURL3)
  ];

  Promise.all(promises).then(urls => {
    return update(ref(db, `timeline/${key}`), {
      title: title,
      imageURL1: urls[0],
      imageURL2: urls[1],
      imageURL3: urls[2],
      category: category2
    });
  }).then(() => {
    notify.innerHTML = "Post updated successfully";
    clearFieldsTimeline();
    GetTimeData();
  }).catch((error) => {
    console.error("Error updating post: ", error);
    notify.innerHTML = "Error updating post";
  });

  document.querySelector('#update_btn3').style.display = 'none';
  document.querySelector('#post_btn3').style.display = 'block';
}

// Initial call to load timeline data
GetTimeData();

/* _-------------------------------- */

// Function to add a new sponsor
function AddSponsor() {
    const title = document.querySelector('#title4').value;
    const post_image5 = document.querySelector('#post_image5').files[0]; // Changed to post_image5
    const category3 = document.querySelector('#category3').value;

    const currentUser = auth.currentUser; // Get the current user
    console.log("Current User:", currentUser); // Debugging statement

    if (!currentUser) {
        alert("You must be logged in to add a post.");
        return;
    }

    // Fetching the userName based on the UID
    const userName = users[currentUser.uid] || "Anonymous"; // Get the user name
    console.log("User Name:", userName); // Debugging statement

    if (!post_image5) {
        alert("Please select an image");
        return;
    }

    const id = Date.now();
    const imageRef5 = storageRef(storage, `sponsors/${id}-${post_image5.name}`);

    uploadBytes(imageRef5, post_image5).then((snapshot) => {
        return getDownloadURL(snapshot.ref);
    }).then((downloadURL) => {
        return set(ref(db, 'sponsors/' + id), {
            title: title,
            imageURL: downloadURL,
            category: category3,
            userId: currentUser.uid,
            userName: userName // Store the correct userName
        });
    }).then(() => {
        notify.innerHTML = "Sponsor Added Successfully";
        clearFieldsSponsors();
        GetSponsorData();
    }).catch((error) => {
        console.error("Error uploading file: ", error);
        notify.innerHTML = "Error adding sponsor";
    });
}

// Function to clear sponsor input fields
function clearFieldsSponsors() {
    document.querySelector('#title4').value = "";
    document.querySelector('#post_image5').value = ""; // Changed to post_image5
    document.querySelector('#category3').value = ""; 
}

// Function to retrieve sponsor data and display it in the table
function GetSponsorData() {
    const user_ref = ref(db, 'sponsors/');
    get(user_ref).then((snapshot) => {
        const data = snapshot.val();
        let html = "";
        const table = document.querySelector('#Sponsors');

        for (const key in data) {
            const { title, imageURL, category, userName } = data[key];

            html += `
                <tr>
                    <td><span class="postNumber"></span></td>
                    <td class="separator">
                        <div><b>${title}</b></div>
                        <div>Added by: ${userName || "ADMIN"}</div>
                        <img src="${imageURL}" alt="Sponsor Image" class="${category}" style="width:100px;height:100px;">
                    </td>
                    <td class="separator"><button class="delete" onclick="deleteSponsorData('${key}')">Delete</button></td>
                    <td class="separator"><button class="update" onclick="updateSponsorData('${key}')">Update</button></td>
                </tr>
            `;
        }
        table.innerHTML = html;
    });
}

// Function to delete sponsor data
window.deleteSponsorData = function (key) {
    const currentUser = auth.currentUser;
    if (!currentUser) {
        alert("You must be logged in to delete a post.");
        return;
    }

    const user_ref = ref(db, `sponsors/${key}`);
    get(user_ref).then((snapshot) => {
        const data = snapshot.val();
        if (!data) {
            notify.innerHTML = "Sponsor not found";
            return;
        }

        // Check if the current user is the owner of the post
        if (data.userId !== currentUser.uid) {
            alert("You can only delete your own posts.");
            return;
        }

        const imageRef = storageRef(storage, data.imageURL);
        remove(user_ref).then(() => {
            return deleteObject(imageRef);
        }).then(() => {
            notify.innerHTML = "Sponsor and associated image deleted successfully";
            GetSponsorData();
        }).catch((error) => {
            console.error("Error deleting data: ", error);
            notify.innerHTML = "Error deleting sponsor";
        });
    });
}

// Function to update sponsor data
window.updateSponsorData = function (key) {
    const currentUser = auth.currentUser;
    if (!currentUser) {
        alert("You must be logged in to update a post.");
        return;
    }

    const user_ref = ref(db, `sponsors/${key}`);
    get(user_ref).then((item) => {
        const data = item.val();
        if (!data) {
            notify.innerHTML = "Sponsor not found";
            return;
        }

        // Check if the current user is the owner of the post
        if (data.userId !== currentUser.uid) {
            alert("You can only update your own posts.");
            return;
        }

        document.querySelector('#title4').value = data.title;
        document.querySelector('#category3').value = data.category;

        // Display update button and hide add button
        document.querySelector('#update_btn4').style.display = 'block';
        document.querySelector('#post_btn4').style.display = 'none';

        // Bind update functionality
        document.querySelector('#update_btn4').onclick = function() {
            updateSponsorData(key, data.imageURL);
        };
    });
}

// Update sponsor data logic
function updateSponsorData(key, oldImageURL) {
    const title = document.querySelector('#title4').value;
    const post_image5 = document.querySelector('#post_image5').files[0]; // Changed to post_image5
    const category3 = document.querySelector('#category3').value;

    const deleteOldImage = (url) => {
        const oldImageRef = storageRef(storage, url);
        return deleteObject(oldImageRef);
    };

    const uploadNewImage = (file, id) => {
        const newImageRef = storageRef(storage, `sponsors/${id}-${file.name}`);
        return uploadBytes(newImageRef, file).then(snapshot => getDownloadURL(snapshot.ref));
    };

    const promises = post_image5 ? deleteOldImage(oldImageURL).then(() => uploadNewImage(post_image5, key)) : Promise.resolve(oldImageURL);

    promises.then((newImageURL) => {
        return update(ref(db, `sponsors/${key}`), {
            title: title,
            imageURL: newImageURL,
            category: category3
        });
    }).then(() => {
        notify.innerHTML = "Sponsor updated successfully";
        clearFieldsSponsors();
        GetSponsorData();
    }).catch((error) => {
        console.error("Error updating sponsor: ", error);
        notify.innerHTML = "Error updating sponsor";
    });

    document.querySelector('#update_btn4').style.display = 'none';
    document.querySelector('#post_btn4').style.display = 'block';
}

// Add event listener for the post button
document.querySelector('#post_btn4').addEventListener('click', AddSponsor);
// Initial call to load sponsor data
GetSponsorData();




// --------------------------------







// Club Functions
const club_post_btn = document.querySelector('#club_post_btn');
const club_update_btn = document.querySelector('#club_update_btn');

function Add_Club() {
    const title = document.querySelector('#Ctitle').value;
    const description1 = document.querySelector('#description1').value;
    const description2 = document.querySelector('#description2').value;
    const imageR = document.querySelector('#imageR').files[0];
    const imageL = document.querySelector('#imageL').files[0];
    const act1 = document.querySelector('#act1').files[0];
    const act2 = document.querySelector('#act2').files[0];
    const act3 = document.querySelector('#act3').files[0];
    const act_title = document.querySelector('#act_title').value;
    const act_desc = document.querySelector('#act_desc').value;
    const act_title2 = document.querySelector('#act_title2').value;
    const act_desc2 = document.querySelector('#act_desc2').value;
    const act_title3 = document.querySelector('#act_title3').value;
    const act_desc3 = document.querySelector('#act_desc3').value;
    const poster = document.querySelector('#poster').files[0];
    const galleryFiles = [
        document.querySelector('#gal1').files[0],
        document.querySelector('#gal2').files[0],
        document.querySelector('#gal3').files[0],
        document.querySelector('#gal4').files[0],
        document.querySelector('#gal5').files[0],
        document.querySelector('#gal6').files[0],
        document.querySelector('#gal7').files[0],
        document.querySelector('#gal8').files[0]
    ];
    const reach_out = document.querySelector('#reach_out').value;
    const number1 = document.querySelector('#Cnumber1').value;
    const number2 = document.querySelector('#Cnumber2').value;
    const instaURL = document.querySelector('#instaURL').value;
    const insta_id = document.querySelector('#insta_id').value;
    const Email = document.querySelector('#Email').value;

    const user = auth.currentUser;

    if (!user) {
        alert("You must be logged in to add a club.");
        return;
    }

    if (!title || !description1 || !description2 || !imageR || !imageL || !act1 || !act2 || !act3 || !poster) {
        alert("Please fill in all required fields and upload all required images.");
        return;
    }

    const id = Date.now();

    const uploadImages = async (files) => {
        const urls = [];
        for (const file of files) {
            if (!file) continue;
            const imageRef = storageRef(storage, `club_images/${id}-${file.name}`);
            await uploadBytes(imageRef, file);
            const downloadURL = await getDownloadURL(imageRef);
            urls.push(downloadURL);
        }
        return urls;
    };

    Promise.all([
        uploadImages([imageR, imageL, act1, act2, act3, poster, ...galleryFiles])
    ]).then(([imageURLs]) => {
        const [
            imageR_URL, imageL_URL, act1_URL, act2_URL, act3_URL, poster_URL,
            gal1_URL, gal2_URL, gal3_URL, gal4_URL, gal5_URL, gal6_URL, gal7_URL, gal8_URL
        ] = imageURLs;

        return set(ref(db, 'clubs/' + id), {
            title: title,
            description1: description1,
            description2: description2,
            imageR: imageR_URL,
            imageL: imageL_URL,
            activities: [
                { title: act_title, description: act_desc, image: act1_URL },
                { title: act_title2, description: act_desc2, image: act2_URL },
                { title: act_title3, description: act_desc3, image: act3_URL }
            ],
            poster: poster_URL,
            gallery: [gal1_URL, gal2_URL, gal3_URL, gal4_URL, gal5_URL, gal6_URL, gal7_URL, gal8_URL].filter(url => url),
            reach_out: reach_out,
            contact: {
                number1: number1,
                number2: number2,
                instaURL: instaURL,
                insta_id: insta_id,
                Email: Email
            },
            uid: user.uid
        });
    }).then(() => {
        alert("Club added successfully!");
        clearClubFields();
        GetClubData();
    }).catch((error) => {
        console.error("Error adding club: ", error);
        alert("Error adding club. Please check console for details.");
    });
}

function clearClubFields() {
    document.querySelector('#Ctitle').value = "";
    document.querySelector('#description1').value = "";
    document.querySelector('#description2').value = "";
    document.querySelector('#imageR').value = "";
    document.querySelector('#imageL').value = "";
    document.querySelector('#act1').value = "";
    document.querySelector('#act2').value = "";
    document.querySelector('#act3').value = "";
    document.querySelector('#act_title').value = "";
    document.querySelector('#act_desc').value = "";
    document.querySelector('#act_title2').value = "";
    document.querySelector('#act_desc2').value = "";
    document.querySelector('#act_title3').value = "";
    document.querySelector('#act_desc3').value = "";
    document.querySelector('#poster').value = "";
    document.querySelector('#gal1').value = "";
    document.querySelector('#gal2').value = "";
    document.querySelector('#gal3').value = "";
    document.querySelector('#gal4').value = "";
    document.querySelector('#gal5').value = "";
    document.querySelector('#gal6').value = "";
    document.querySelector('#gal7').value = "";
    document.querySelector('#gal8').value = "";
    document.querySelector('#reach_out').value = "";
    document.querySelector('#Cnumber1').value = "";
    document.querySelector('#Cnumber2').value = "";
    document.querySelector('#instaURL').value = "";
    document.querySelector('#insta_id').value = "";
    document.querySelector('#Email').value = "";
}

function GetClubData() {
    const club_ref = ref(db, 'clubs/');
    get(club_ref).then((snapshot) => {
        const data = snapshot.val();
        let html = "";
        const table = document.querySelector('#clubs_table');

        for (const key in data) {
            const club = data[key];
            const username = users[club.uid] || "ADMIN";

            html += `
            <tr>
                <td><span class="clubNumber"></span></td>
                <td class="separator">
                    <div><b>${club.title}</b> by <i>${username}</i></div>
                    <img src="${club.imageR}" alt="Club Image" style="width:100px;height:100px;">
                </td>
                <td class="separator">
                    <button class="delete" onclick="deleteClub('${key}', '${club.uid}')">Delete</button>
                </td>
                <td class="separator">
                    <button class="update" onclick="updateClub('${key}', '${club.uid}')">Update</button>
                </td>
                <td class="separator">
                    <a href="../club-details/index.html?id=${key}" class="details">View Details</a>
                </td>
            </tr>`;
        }
        table.innerHTML = html;
    }).catch((error) => {
        console.error("Error fetching clubs: ", error);
        alert("Error fetching clubs. Please try again.");
    });
}

window.deleteClub = function (key, clubUID) {
    const user = auth.currentUser;
    if (!user) return alert("You must be logged in to delete a club.");
    
    if (adminUID[user.uid] || user.uid === postUID) { 
        const club_ref = ref(db, `clubs/${key}`);
        
        get(club_ref).then((snapshot) => {
            const data = snapshot.val();
            const images = [
                data.imageR, 
                data.imageL, 
                ...data.activities.map(act => act.image), 
                data.poster, 
                ...data.gallery
            ].filter(url => url);

            const deletePromises = images.map(url => {
                try {
                    // Properly decode the URL and extract the path
                    const decodedUrl = decodeURIComponent(url);
                    const pathStart = decodedUrl.indexOf('/o/') + 3;
                    const pathEnd = decodedUrl.indexOf('?');
                    const fullPath = decodedUrl.slice(pathStart, pathEnd);
                    
                    // Alternative method using URL object
                    const urlObj = new URL(url);
                    const pathFromUrl = decodeURIComponent(urlObj.pathname);
                    const correctPath = pathFromUrl.replace('/v0/b/' + firebaseConfig.storageBucket + '/o/', '');
                    
                    return deleteObject(storageRef(storage, correctPath));
                } catch (error) {
                    console.warn("Error parsing URL:", url, error);
                    return Promise.resolve(); // Skip invalid URLs
                }
            });

            return Promise.all([
                remove(club_ref),
                ...deletePromises
            ]);
        }).then(() => {
            GetClubData();
            alert("Club deleted successfully!");
        }).catch(error => {
            console.error("Delete error:", error);
            alert("Club data deleted, but some images might not exist. Check console for details.");
        });
    } else {
        alert("You can only delete clubs you created!");
    }
};

window.updateClub = function (key, clubUID) {
    const user = auth.currentUser;
    if (!user) return alert("You must be logged in to update a club.");
    
    if (adminUID[user.uid] || user.uid === postUID) { 
        const club_ref = ref(db, `clubs/${key}`);
        
        get(club_ref).then((snapshot) => {
            const data = snapshot.val();
            
            // Populate form fields
            document.querySelector('#Ctitle').value = data.title;
            document.querySelector('#description1').value = data.description1;
            document.querySelector('#description2').value = data.description2;
            document.querySelector('#act_title').value = data.activities[0].title;
            document.querySelector('#act_desc').value = data.activities[0].description;
            document.querySelector('#act_title2').value = data.activities[1].title;
            document.querySelector('#act_desc2').value = data.activities[1].description;
            document.querySelector('#act_title3').value = data.activities[2].title;
            document.querySelector('#act_desc3').value = data.activities[2].description;
            document.querySelector('#reach_out').value = data.reach_out;
            document.querySelector('#Cnumber1').value = data.contact.number1;
            document.querySelector('#Cnumber2').value = data.contact.number2;
            document.querySelector('#instaURL').value = data.contact.instaURL;
            document.querySelector('#insta_id').value = data.contact.insta_id;
            document.querySelector('#Email').value = data.contact.Email;

            club_update_btn.setAttribute('data-key', key);
            club_post_btn.style.display = 'none';
            club_update_btn.style.display = 'block';
        });
    } else {
        alert("You can only update clubs you created!");
    }
};

club_post_btn.addEventListener('click', Add_Club);
club_update_btn.addEventListener('click', () => {
    const key = club_update_btn.getAttribute('data-key');
    // Implement update logic similar to Add_Club but with update() instead of set()
    // You'll need to handle image updates carefully
});

// Initialize clubs
GetClubData();



        </script>










































































      <style>
        /* Styles for dropdown */
        .dropdown_content {
            display: none;
            /* Adjust other styles as needed */





        }
    </style>
</body>
</html>



<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,900;1,500;1,700&display=swap');


*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    text-decoration: none;
    list-style: none;
}

body{
    font-family: 'Roboto', sans-serif;
    counter-reset: section;
    
}


/* login  */

.login{
    width: 50%;
    margin: 0 auto;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;

}

.login h1{
    text-align: end;
    padding: 5px;
}

.login input {
    display: block;
    margin: 10px 0;
    padding: 5px 10px;
    border: 1px solid #111;
     outline: none;
     width: 100%;
}

.login button{
    width: 100%;
    padding: 5px 10px;
    background: #111;
    border: 1px solid #111;
    color: #fff;
    text-align: center;
    transition: 0.4s ease-in;
    cursor: pointer;

}

.login button:hover{
    background: transparent;
    color: #111;
}


.container.main{
  
border-radius: 200px;
    padding: 0% !important;
    box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px, rgba(164, 19, 19, 0.24) 0px 1px 2px;

}
/* header */

header {
    background: #09015f;
    color: #fff;
    width: 100%;
    padding: 10px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

header .logo {
    margin-left: 20px;
}

header .logo img {
    height: 40px; /* Adjust according to your logo size */
}

header nav {
    display: flex;
    align-items: center;
    width: 100%;
    height: 50px;
    justify-content: space-between;
}

header ul {
    list-style: none;
    display: flex;
    margin-right: 20px;
    padding: 0;
}

header ul li {
    margin: 0 15px;
}

header ul li a {
    color: #fff;
    text-decoration: none;
    transition: color 0.3s ease;
}

header ul li a:hover {
    color: #ff9900; /* Change to your desired hover color */
}


.notify {
    background: green;
    color: #fff;
    text-align: center;
    width: 50% !important;

    font-size: 18px;
    border-radius: 20px;
 margin-bottom: 2% !important;
 margin-top: 2% !important;

    box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
}



/* post */

.main_content{
    display: grid;
  border: 2px solid;
  border-radius: 40px; 
}

.main_content .post_form {
    width: 450px;


    padding: 20px !important;
}

.main_content .post_form input ,textarea{
    width: 100%;
    border: 2px solid #111;
    padding: 5px ;
    margin: 10px 0;
    border-radius: 10px;
}

.main_content .post_form button{
    width: 100%;
    background: #111;
    color: #fafafa;
    padding: 5px 0;
    border: 1px solid #111;
    transition: 0.5s ease-in-out;
    margin-top: 5%;
    border-radius: 20px;
}
.main_content .post_form button:hover{
    background: midnightblue;
}


/* update_btn */

.my_blog{
    display: none;
    background-image: url(https://firebasestorage.googleapis.com/v0/b/myapp-8ecc3.appspot.com/o/Cultfiesta%2Fbackground%2Fbg1.png?alt=media&token=d1f773fe-4a2d-4b91-b74b-3ce3a714fb0b);
    min-height: 70vh;
    background-position: center;
    background-size:contain;
    position: relative;
    background-color: white;
    background-attachment: fixed;
}


.update_btn {
    display: none;
}
.update_btn1 {
    display: none;
}
.update_btn3 {
    display: none;
}
.show{
    display: block;
}
.hide{
    display: none;
}
/* notify */

.notify {
    width: 80%;
    display: block;
    margin:  0 auto;
    text-align: center;
    background: green;
    color: #fff;
    margin-top: 70px;
    
}


/* my_content */
.dropdown_container{
width: 100% !important;
margin-bottom: 2%;
padding: 10px;
border-radius: 20px;
background-color: #ffffff; /* Optional: Add a background color */
box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px, rgb(51, 51, 51) 0px 0px 0px 3px;

}
.dropdown_trigger{
    z-index: -1000;
text-align: center;
background-color: #ffffff; /* Optional: Add a background color */


}

.dropdown_trigger h3{
    border-radius: 200px;
    
}


.separator {
    border-bottom: 3px solid black;
    padding-bottom: 5%;
}

.my_content {
    
    width: 100%;
 
    
    
}

.my_content table td img{
    object-fit: contain;
    height: 150px !important;
    margin-top: 0% !important;
}

.my_content table td b{
  font-size: larger;
  
}
.my_content table {
    width: 100%;
    margin: 50px auto;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    padding: 50px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    border-radius: 30px;
}

.my_content table tr{
    margin: 30px 0;
    width: 100%;
    padding-left: 2% !important;
  
}



.my_content table tr button{
    padding: 7px 10px;
    border: 1px solid #111;
    border-radius: 15px;
   transition: .5s ease-in;
   color: #fff;
   cursor: pointer;
}

.my_content table tr button.delete{
    background: rgb(106, 8, 8);
}
.my_content table tr button.update{
    background: rgb(8, 67, 106);
}
.my_content table tr button:hover{
    background: transparent;
    color: #111;
}

/* -----------------------------------------÷
 */
 .my_content2 {
    width: 100%;
 
    
    
}
.col {
  flex: 1 0 0%;
  display: flex;
  justify-content: center;
}
 
.my_content2 table td b{
    font-size: larger;
    
  }
  .my_content2 table {
      width: 100%;
      margin: 50px auto;
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      padding: 50px;
      box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
      border-radius: 20px;
      background-color: #060616;
  }
  
  .my_content2 table tr{
      margin: 30px 0;
      width: 100%;
      padding-left: 2% !important;
    
  }
  
  
  
  .my_content2 table tr button{
      padding: 7px 10px;
      border: 1px solid #111;
      border-radius: 15px;
     transition: .5s ease-in;
     color: #fff;
     cursor: pointer;
     margin: 5%;
  }
  
  .my_content2 table tr button.delete{
      background: rgb(106, 8, 8);
  }
  .my_content2 table tr button.update{
      background: rgb(8, 67, 106);
  }
  .my_content2 table tr button:hover{
      background: transparent;
      color: #111;
  }
  
/* id */

.postNumber{
    height: 20px;
    display: inline-block;
    width: 20px;
}

.postNumber::before{
    counter-increment: section;
    content: counter(section) ;
}


/*  */


.main {

    margin: 0  auto;
    padding: 60px 0;
}

.post {
    margin: 20px 0;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    padding: 20px;
}
.post h2{
    padding: 10px 0;
}

footer{
    width: 100%;
    height: 70px;
    line-height: 70px;
    color: #fff;
    background: #111;
    text-align: center;
}

.white {
    color: white;
}

.green {
    color: green;
}

.red {
    color: red;
}


.cover {
    object-fit: cover;
  }
  
  .fill {
    object-fit: fill;
  }
  
  .contain {
    object-fit: contain;
  }
  

  /* ------------------------------ */
  
/* ------------------------------------Footer----------------------------------- */

.footer{
    background-color: #d7d7d7;
    background-image: url(https://firebasestorage.googleapis.com/v0/b/myapp-8ecc3.appspot.com/o/Cultfiesta%2Fbackground%2Fbg4.jpg?alt=media&token=bb6616ce-d1bf-461b-acd3-d37f6840953c );
  


    
    /* height: 300px; */
    
width: 100%;
text-align: center;
padding: 30px 0;
color: #feffff;

}
.footer h4{
margin-bottom: 25px;
margin-top: 15PX;
font-weight: 600;
font-size: 40px;


}

.icons{
margin-bottom: 7px;

}
.icons a {
    text-decoration: none;
    color: #ffffff;
    

}



/* ----------------------------------------------------------------------------------------- */
.container2 {
 width: 80%;
    background: #f8f9fd;
    background: linear-gradient(
      0deg,
      rgb(255, 255, 255) 0%,
      rgb(244, 247, 251) 100%
    );
    border-radius: 40px;
    padding: 25px 35px;
    border: 5px solid rgb(255, 255, 255);
    box-shadow: rgba(133, 189, 215, 0.8784313725) 0px 30px 30px -20px;
    margin: 20px;
  }
  
  .heading {
    text-align: center;
    font-weight: 900;
    font-size: 30px;
    color: rgb(16, 137, 211);
  }
  
  .form {
    margin-top: 20px;
  }
  
  .form .input {
    width: 100%;
    background: white;
    border: none;
    padding: 15px 20px;
    border-radius: 20px;
    margin-top: 15px;
    box-shadow: #cff0ff 0px 10px 10px -5px;
    border-inline: 2px solid transparent;
  }
  
  .form .input::-moz-placeholder {
    color: rgb(170, 170, 170);
  }
  
  .form .input::placeholder {
    color: rgb(170, 170, 170);
  }
  
  .form .input:focus {
    outline: none;
    border-inline: 2px solid #12b1d1;
  }
  
  .form .forgot-password {
    display: block;
    margin-top: 10px;
    margin-left: 10px;
  }
  
  .form .forgot-password a {
    font-size: 11px;
    color: #0099ff;
    text-decoration: none;
  }
  
  .form .login-button {
    display: block;
    width: 100%;
    font-weight: bold;
    background: linear-gradient(
      45deg,
      rgb(16, 137, 211) 0%,
      rgb(18, 177, 209) 100%
    );
    color: white;
    padding-block: 15px;
    margin: 20px auto;
    border-radius: 20px;
    box-shadow: rgba(133, 189, 215, 0.8784313725) 0px 20px 10px -15px;
    border: none;
    transition: all 0.2s ease-in-out;
  }
  
  .form .login-button:hover {
    transform: scale(1.03);
    box-shadow: rgba(133, 189, 215, 0.8784313725) 0px 23px 10px -20px;
  }
  
  .form .login-button:active {
    transform: scale(0.95);
    box-shadow: rgba(133, 189, 215, 0.8784313725) 0px 15px 10px -10px;
  }
  
  .social-account-container {
    margin-top: 25px;
  }
  
  .social-account-container .title {
    display: block;
    text-align: center;
    font-size: 10px;
    color: rgb(170, 170, 170);
  }
  
  .social-account-container .social-accounts {
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 5px;
  }
  
  .social-account-container .social-accounts .social-button {
    background: linear-gradient(45deg, rgb(0, 0, 0) 0%, rgb(112, 112, 112) 100%);
    border: 5px solid white;
    padding: 5px;
    border-radius: 50%;
    width: 40px;
    aspect-ratio: 1;
    display: grid;
    place-content: center;
    box-shadow: rgba(133, 189, 215, 0.8784313725) 0px 12px 10px -8px;
    transition: all 0.2s ease-in-out;
  }
  
  .social-account-container .social-accounts .social-button .svg {
    fill: white;
    margin: auto;
  }
  
  .social-account-container .social-accounts .social-button:hover {
    transform: scale(1.2);
  }
  
  .social-account-container .social-accounts .social-button:active {
    transform: scale(0.9);
  }
  
  .agreement {
    display: block;
    text-align: center;
    margin-top: 15px;
  }
  
  .agreement a {
    text-decoration: none;
    color: #0099ff;
    font-size: 9px;
  }
  </style>




<!-- responsive   -->


<style>@media(max-width: 1199px){
  .header_sec_bottom_in ul.navbar-nav a.nav-link {
      font-size: 15px; 
      padding: 0 9px;   
  }

  @media(max-width: 991px){
  
  .navbar-toggler-icon i {
      color: #ff6500;
      font-size: 40px;
  }
  .navbar-toggler {
      padding: 0;
      line-height: 1;
      font-size: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  span.navbar-toggler-icon {
      width: auto;
      height: auto;
  }
  .navbar-toggler:focus{
      outline: 0;
  }
  .header_sec_bottom_in ul.navbar-nav a.nav-link {
      font-size: 15px;
      margin: 10px 0;
      padding: 0;
      border: 0;
  }
  .navbar-collapse {
      padding-top: 10px;
  }
  .navbar_right {
      display: flex;
      align-items: center;
      margin-left: 0;
      margin-top: 11px;
      margin-bottom: 15px;
  }
  .navbar_right_seach {
      position: inherit;
  }
  .navbar_right_seach_con {
      position: absolute;
      left: 0;
      background: #09015f;
      border-radius: 7px;
      width: 100%;
      margin-top: 5px;
      z-index: 1;
      right: auto;
  }
  .form-control {
      height: 40px;
  }

  }
  
  @media(width > 1500px){
      .bgv{
          /* position: absolute; */
          right: 0;
          bottom: 0;
          z-index: -1;
          height: 100% !important;
        
         
      }



  }
  @media(max-width: 767px){
 
  a.navbar-brand {
      flex: 0 0 60px;
  }
  .navbar-toggler-icon i {
      font-size: 30px;
  }
  .navbar-toggler {
      width: 30px;
      height: 30px;
  }

  .tabs_sec1 .nav-tabs .nav-link {
      min-width: 80px;
      font-size: 14px;
  }
  .nav-tabs .nav-item {
      min-width: 140px;
      max-width: 140px;
  }
  .tabs_sec1 .nav-tabs {
      margin-bottom: 10px;
  }

  .header_sec_links ul {
      display: block;
      text-align: center;
  }
  .header_sec_links ul li {
      display: inline-block;
      padding: 0 10px;
      vertical-align:middle;
      max-width:110px;
  }
      
  .header_sec_links > ul > li > a {
      font-size:13px;
      white-space:normal;
  }	
  
  }
  
}

@media(width<400px){

  .main_content .post_form {
 
      width: 90% !important;
   
      
  }
  
  .main_content .post_form input ,textarea{
      width: 95%;
    
   
     
  }
  .main_content .post_form button{
      width: 95%;
    
  }
  .my_content2 {
      width: 100%;
      padding: 0;
      display: flex;
      justify-content: center;
  }

  .my_content {
      width: 100%;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
  }


}

@media only screen and (max-width: 500px){
.main_content .post_form input, textarea {
  width: 90%;
  border: 2px solid #111;
  padding: 5px;
  margin: 10px 0;
  border-radius: 10px;
}

.my_content {
  width: 100%;
  padding:0;
}

.my_content table {
  width: 90%;
  margin: 0;
  margin-top: 10%;
}


.my_content2 {
  width: 100%;
  padding: 0;
}

.my_content2 table {
  width: 90%;
 
  background-color: #1d1d5e;
  border-radius: 20px;
}

.my_content2 table {

  margin:0;
  margin-top: 5%;
  margin-bottom: 5%;

}

}

.container2 {

  width: 350px;

}



</style>